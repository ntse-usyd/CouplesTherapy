<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Couples Relationship Self-Assessment</title>
  <!-- React UMD + Babel for single-file dev. Swap to production builds for deployment -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0f15; --card:#101623; --muted:#8aa0b3; --text:#e6eef6; --accent:#46b2ff; --bad:#f06d6d; --good:#43d08a; --warn:#f7b955;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0;}
    body{font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:linear-gradient(180deg,#09111d,#0b0f15 20% 80%,#070b11); color:var(--text);}
    header{position:sticky; top:0; z-index:20; backdrop-filter: blur(8px); background: linear-gradient(180deg, rgba(11,15,21,.9), rgba(11,15,21,.6)); border-bottom:1px solid rgba(255,255,255,.06)}
    .wrap{max-width:980px; margin:0 auto; padding:24px; width:100%}
    main{padding-bottom:96px;} /* keeps content clear of fixed control bar */

    h1{margin:0 0 8px; font-size:28px}
    p.lead{margin:0; color:var(--muted)}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .grid{display:grid; gap:16px}
    .grid.cols-2{grid-template-columns:1fr;}
    @media (min-width:900px){.grid.cols-2{grid-template-columns:1fr 1fr}}
    .section-title{font-size:18px; margin:8px 0 12px}
    .progress{height:10px; background:#0a1320; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
    .progress > div{height:100%; background:linear-gradient(90deg, var(--accent), #7ad3ff); width:0%}

    .question{padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,.06); background:rgba(255,255,255,.02)}
    .q-text{font-weight:500; line-height:1.4}
    .likert{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
    .opt{flex:1; min-width:140px}
    .opt input{display:none}
    .pill{display:flex; align-items:center; justify-content:center; gap:6px; height:38px; border-radius:999px; background:#0b1422; border:1px solid rgba(255,255,255,.08); color:#cfe7ff; cursor:pointer; transition:all .15s ease; user-select:none}
    .pill:hover{border-color:rgba(255,255,255,.18); transform:translateY(-1px)}
    .pill.active{background:linear-gradient(180deg,#11223a,#0d1a2c); border-color:#60c3ff; color:#fff; box-shadow:0 0 0 3px rgba(96,195,255,.15)}

    /* Fixed controls bar always visible */
    .controls{position:fixed; bottom:0; left:0; right:0; z-index:30; background:rgba(10,16,26,.96); backdrop-filter:blur(8px); padding:12px; border-top:1px solid rgba(255,255,255,.08)}
    .controls .bar{display:flex; gap:12px; max-width:980px; margin:0 auto; flex-wrap:wrap; align-items:center}
    .btn{appearance:none; border:1px solid rgba(255,255,255,.12); background:#0e1625; color:#e7f2ff; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600; text-align:center}
    .btn.primary{background:linear-gradient(180deg,#1b6aff,#0d4de6); border-color:#2f74ff}
    .btn.ghost{background:transparent}
    .spacer{flex:1}

    .results{margin-top:20px}
    .metric{display:grid; grid-template-columns:220px 1fr; gap:12px; align-items:center; padding:10px 12px; border-bottom:1px dashed rgba(255,255,255,.08)}
    .barline{height:12px; background:#0a1320; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.06)}
    .barline > div{height:100%; background:linear-gradient(90deg, #43d08a, #7be39a)}
    .score-tag{font-weight:700}
    .hint{color:var(--muted); font-size:12px}

    @media print{ header,.controls{display:none} main{padding-bottom:0} body{background:#fff;color:#000} .card{box-shadow:none;border-color:#ddd} .question{background:#fff} }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Couples Relationship Self-Assessment</h1>
      <p class="lead">Answer 50 Likert-scale items. Your results compute five research-aligned dimensions: Attachment Anxiety, Attachment Avoidance, Interaction Constructiveness, Affect & Repair, Cohesion & Flexibility.</p>
    </div>
  </header>

  <main class="wrap">
    <div id="app"></div>
  </main>

  <div class="controls">
    <div class="bar">
      <button class="btn ghost" id="resetBtn">Reset</button>
      <button class="btn" id="csvBtn">Export CSV</button>
      <button class="btn" id="jsonBtn">Export JSON</button>
      <span class="spacer"></span>
      <button class="btn primary" id="submitBtn">Submit & Compute</button>
    </div>
  </div>

  <script type="text/babel">
    const {useState, useMemo, useEffect, useCallback} = React;

    // ---------- Dimensions ----------
    const DIMENSIONS = {
      anxiety:   { key:'anxiety',   title:'Attachment Anxiety',                orientation:'higher = more anxious (insecure)' },
      avoidance: { key:'avoidance', title:'Attachment Avoidance',              orientation:'higher = more avoidant (insecure)' },
      interaction:{ key:'interaction', title:'Interaction Pattern (Constructiveness)', orientation:'higher = more constructive; lower = demand–withdraw' },
      affect:    { key:'affect',    title:'Affect & Repair Balance',          orientation:'higher = better affect balance & repair' },
      cohesion:  { key:'cohesion',  title:'Cohesion & Flexibility',            orientation:'higher = healthier balance of closeness & adaptability' },
    };

    // ---------- Questions (50) ----------
    const QUESTIONS = [
      // Attachment Anxiety (1-10)
      {id:1, text:'I often worry my partner doesn’t love me as much as I love them.', dim:'anxiety'},
      {id:2, text:'I feel anxious if my partner doesn’t respond quickly to messages.', dim:'anxiety'},
      {id:3, text:'I need frequent reassurance about my partner’s commitment.', dim:'anxiety'},
      {id:4, text:'I fear that if I make a mistake, my partner might leave me.', dim:'anxiety'},
      {id:5, text:'I sometimes test my partner’s loyalty to see if they really care.', dim:'anxiety'},
      {id:6, text:'When my partner is distant, I feel panicked or rejected.', dim:'anxiety'},
      {id:7, text:'I worry about being abandoned even in a stable relationship.', dim:'anxiety'},
      {id:8, text:'I rely heavily on my partner to feel secure.', dim:'anxiety'},
      {id:9, text:'I often feel more invested in the relationship than my partner.', dim:'anxiety'},
      {id:10, text:'I struggle to relax if I sense emotional distance.', dim:'anxiety'},

      // Attachment Avoidance (11-20)
      {id:11, text:'I prefer not to depend too much on my partner.', dim:'avoidance'},
      {id:12, text:'I feel uncomfortable when my partner is very affectionate.', dim:'avoidance'},
      {id:13, text:'I need a lot of space and independence in my relationship.', dim:'avoidance'},
      {id:14, text:'I downplay my needs to avoid appearing vulnerable.', dim:'avoidance'},
      {id:15, text:'I feel trapped if my partner wants too much closeness.', dim:'avoidance'},
      {id:16, text:'I have difficulty opening up about my emotions.', dim:'avoidance'},
      {id:17, text:'I’d rather solve problems alone than ask for support.', dim:'avoidance'},
      {id:18, text:'I withdraw when my partner expresses strong feelings.', dim:'avoidance'},
      {id:19, text:'I avoid deep discussions about the future.', dim:'avoidance'},
      {id:20, text:'I feel uneasy when someone relies heavily on me.', dim:'avoidance'},

      // Interaction Pattern (Demand–Withdraw vs Constructive) (21-30)
      {id:21, text:'When problems arise, I raise them directly with my partner.', dim:'interaction', positive:true},
      {id:22, text:'My partner and I take turns listening and speaking during conflict.', dim:'interaction', positive:true},
      {id:23, text:'I tend to pursue my partner until they respond, even if they withdraw.', dim:'interaction', positive:false},
      {id:24, text:'My partner tends to withdraw when I press for discussion.', dim:'interaction', positive:false},
      {id:25, text:'Our arguments often escalate without resolution.', dim:'interaction', positive:false},
      {id:26, text:'We are able to compromise during disagreements.', dim:'interaction', positive:true},
      {id:27, text:'I sometimes avoid important issues to keep the peace.', dim:'interaction', positive:false},
      {id:28, text:'My partner and I often get stuck in the same fight repeatedly.', dim:'interaction', positive:false},
      {id:29, text:'We are able to revisit conflicts calmly and reach solutions.', dim:'interaction', positive:true},
      {id:30, text:'One of us often demands change while the other resists or shuts down.', dim:'interaction', positive:false},

      // Affect & Repair Balance (31-40)
      {id:31, text:'Positive moments outweigh negative ones in our relationship.', dim:'affect', positive:true},
      {id:32, text:'Even during fights, I still feel loved by my partner.', dim:'affect', positive:true},
      {id:33, text:'Our arguments leave long-lasting hurt.', dim:'affect', positive:false},
      {id:34, text:'We are able to laugh or show affection again after conflict.', dim:'affect', positive:true},
      {id:35, text:'Criticism outweighs appreciation in our daily interactions.', dim:'affect', positive:false},
      {id:36, text:'Small gestures of kindness help us reconnect after fights.', dim:'affect', positive:true},
      {id:37, text:'I often feel emotionally drained after spending time together.', dim:'affect', positive:false},
      {id:38, text:'We can repair misunderstandings relatively quickly.', dim:'affect', positive:true},
      {id:39, text:'Negative comments or contempt feel more common than compliments.', dim:'affect', positive:false},
      {id:40, text:'I feel that our relationship is built on respect and goodwill.', dim:'affect', positive:true},

      // Cohesion & Flexibility (41-50)
      {id:41, text:'We enjoy spending time together, but also respect each other’s independence.', dim:'cohesion', positive:true},
      {id:42, text:'Our relationship adapts well to life changes (e.g., job shifts, children).', dim:'cohesion', positive:true},
      {id:43, text:'We share responsibilities fairly in the household.', dim:'cohesion', positive:true},
      {id:44, text:'We have rituals or routines that make us feel connected.', dim:'cohesion', positive:true},
      {id:45, text:'Stressful events often overwhelm us as a couple.', dim:'cohesion', positive:false},
      {id:46, text:'We talk openly about goals and values for the future.', dim:'cohesion', positive:true},
      {id:47, text:'We can adjust roles (e.g., work vs caregiving) when needed.', dim:'cohesion', positive:true},
      {id:48, text:'We support each other when facing outside stress.', dim:'cohesion', positive:true},
      {id:49, text:'We struggle to stay connected when life gets busy.', dim:'cohesion', positive:false},
      {id:50, text:'Our partnership feels like a team effort.', dim:'cohesion', positive:true},
    ];

    const LIKERT = [
      {value:1, label:'Strongly Disagree'},
      {value:2, label:'Disagree'},
      {value:3, label:'Neutral'},
      {value:4, label:'Agree'},
      {value:5, label:'Strongly Agree'},
    ];

    // ---------- Utils ----------
    const mean = (nums)=> nums.length ? nums.reduce((a,b)=>a+b,0)/nums.length : 0;

    function computeScores(answers){
      const byDim = {anxiety:[], avoidance:[], interaction:[], affect:[], cohesion:[]};
      for(const q of QUESTIONS){
        const v = Number(answers[q.id]);
        if(!v) continue;
        if(q.dim === 'anxiety' || q.dim === 'avoidance'){
          byDim[q.dim].push(v); // higher = more insecure
        } else {
          const val = q.positive ? v : (6 - v); // reverse negative items
          byDim[q.dim].push(val); // higher = healthier
        }
      }
      const scores = {
        anxiety: Number(mean(byDim.anxiety).toFixed(2)),
        avoidance: Number(mean(byDim.avoidance).toFixed(2)),
        interaction: Number(mean(byDim.interaction).toFixed(2)),
        affect: Number(mean(byDim.affect).toFixed(2)),
        cohesion: Number(mean(byDim.cohesion).toFixed(2)),
      };
      scores.securityIndex = Number((6 - mean([scores.anxiety||0, scores.avoidance||0])).toFixed(2));
      return scores;
    }

    function labelBand(value, goodHigh=true){
      if(goodHigh){
        if(value >= 4.2) return 'High';
        if(value >= 3.2) return 'Moderate';
        return 'Low';
      } else {
        if(value >= 4.0) return 'High (elevated)';
        if(value >= 2.8) return 'Moderate';
        return 'Low';
      }
    }

    function classifyProfile(s){
      const isSecure = s.anxiety < 2.5 && s.avoidance < 2.5 && s.interaction >= 3.5 && s.affect >= 3.5;
      if(isSecure) return {type:'Secure Connector', note:'Low anxiety/avoidance with constructive dialogue and good repair.'};
      const isPursuer = s.anxiety >= 3.5 && s.avoidance <= 3.0 && s.interaction <= 2.8;
      if(isPursuer) return {type:'Pursuer Pattern', note:'High attachment anxiety with demand-oriented conflict approach.'};
      const isWithdrawer = s.avoidance >= 3.5 && s.anxiety <= 3.0 && s.interaction <= 2.8;
      if(isWithdrawer) return {type:'Withdrawer Pattern', note:'High attachment avoidance with withdrawal in conflict.'};
      const isSilent = s.avoidance >= 3.5 && s.affect <= 3.0 && s.cohesion <= 3.0;
      if(isSilent) return {type:'Silent Pair', note:'Low expressiveness, weak cohesion and repair; parallel lives risk.'};
      const isHostile = s.affect <= 2.5 && s.interaction <= 2.5;
      if(isHostile) return {type:'Hostile/Hostile-Detached', note:'High negativity with poor repair; consider guided intervention.'};
      const isVolatile = s.interaction >= 3.0 && s.affect >= 3.5 && s.anxiety >= 2.8 && s.avoidance >= 2.5;
      if(isVolatile) return {type:'Volatile Pair', note:'High energy/conflict but strong affection and repair keep stability.'};
      return {type:'Mixed/Transitional', note:'No single dominant pattern. Review dimension scores for targeted work.'};
    }

    function toCSV(scores, answers){
      const rows = [];
      rows.push(['Dimension','Score']);
      for(const [k,v] of Object.entries(scores)){
        if(k==='securityIndex') continue;
        rows.push([k, v]);
      }
      rows.push(['securityIndex', scores.securityIndex]);
      rows.push([]);
      rows.push(['id','dimension','text','answer(1-5)']);
      for(const q of QUESTIONS){
        rows.push([q.id, q.dim, q.text.replaceAll('\n',' '), answers[q.id]||'']);
      }
      return rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n');
    }

    function download(filename, text){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(new Blob([text], {type:'text/plain'}));
      a.download = filename; a.click(); URL.revokeObjectURL(a.href);
    }

    // ---------- Components ----------
    function Likert({qid, value, onChange}){
      return (
        <div className="likert" role="radiogroup" aria-labelledby={`q-${qid}`}>
          {LIKERT.map(opt=> (
            <label key={opt.value} className="opt">
              <input type="radio" name={`q-${qid}`} value={opt.value}
                     checked={Number(value)===opt.value}
                     onChange={e=>onChange(qid, Number(e.target.value))} />
              <div className={"pill "+(Number(value)===opt.value? 'active':'')}>{opt.value} · {opt.label}</div>
            </label>
          ))}
        </div>
      );
    }

    function Section({dimKey, items, answers, setAnswer}){
      const d = DIMENSIONS[dimKey];
      return (
        <section className="card" style={{marginBottom:16}}>
          <div className="section-title">{d.title} <span className="hint">({d.orientation})</span></div>
          <div className="grid">
            {items.map(q=> (
              <div key={q.id} className="question">
                <div id={`q-${q.id}`} className="q-text">{q.id}. {q.text}</div>
                <Likert qid={q.id} value={answers[q.id]} onChange={setAnswer} />
              </div>
            ))}
          </div>
        </section>
      );
    }

    function Metric({label, value, goodHigh=true}){
      const pct = Math.max(0, Math.min(100, (value-1)/4*100));
      const band = labelBand(value, goodHigh);
      return (
        <div className="metric">
          <div>
            <div style={{fontWeight:700}}>{label}</div>
            <div className="hint">{goodHigh? 'Higher is healthier.' : 'Higher indicates more insecurity.'}</div>
          </div>
          <div>
            <div className="barline"><div style={{width:pct+'%'}}></div></div>
            <div style={{display:'flex', justifyContent:'space-between', marginTop:6}}>
              <span className="score-tag">{value.toFixed(2)} / 5</span>
              <span className="hint">{band}</span>
            </div>
          </div>
        </div>
      );
    }

    function App(){
      const [answers, setAnswers] = useState({});
      const [submitted, setSubmitted] = useState(false);

      const counts = useMemo(()=>({
        total: QUESTIONS.length,
        answered: Object.values(answers).filter(Boolean).length,
      }), [answers]);

      const sections = useMemo(()=>({
        anxiety: QUESTIONS.filter(q=>q.dim==='anxiety'),
        avoidance: QUESTIONS.filter(q=>q.dim==='avoidance'),
        interaction: QUESTIONS.filter(q=>q.dim==='interaction'),
        affect: QUESTIONS.filter(q=>q.dim==='affect'),
        cohesion: QUESTIONS.filter(q=>q.dim==='cohesion'),
      }), []);

      const scores = useMemo(()=> computeScores(answers), [answers]);
      const profile = useMemo(()=> classifyProfile(scores), [scores]);

      const setAnswer = useCallback((qid, val)=> setAnswers(prev=> ({...prev, [qid]: val})), []);

      const canSubmit = counts.answered === counts.total;

      const doSubmit = useCallback(()=>{
        if(!canSubmit){
          const ok = confirm(`You have answered ${counts.answered} of ${counts.total} items. Compute results anyway?`);
          if(!ok) return;
        }
        setSubmitted(true);
        window.scrollTo({top:0, behavior:'smooth'});
      }, [canSubmit, counts]);

      const doReset = useCallback(()=>{ setAnswers({}); setSubmitted(false); }, []);
      const doCSV = useCallback(()=> download('couples_assessment_results.csv', toCSV(scores, answers)), [scores, answers]);
      const doJSON = useCallback(()=> download('couples_assessment_results.json', JSON.stringify({scores, profile, answers}, null, 2)), [scores, profile, answers]);

      // Wire fixed buttons outside React tree
      useEffect(()=>{
        const submitBtn = document.getElementById('submitBtn');
        const resetBtn = document.getElementById('resetBtn');
        const csvBtn = document.getElementById('csvBtn');
        const jsonBtn = document.getElementById('jsonBtn');
        submitBtn.onclick = doSubmit;
        resetBtn.onclick = doReset;
        csvBtn.onclick = doCSV;
        jsonBtn.onclick = doJSON;
        return ()=>{
          submitBtn.onclick = null; resetBtn.onclick = null; csvBtn.onclick = null; jsonBtn.onclick = null;
        };
      }, [doSubmit, doReset, doCSV, doJSON]);

      const progressPct = Math.round((counts.answered / counts.total) * 100);

      return (
        <div>
          <div className="card" style={{marginBottom:16}}>
            <div className="grid cols-2">
              <div>
                <div className="section-title">How it works</div>
                <p className="hint">Rate each statement 1 (Strongly Disagree) to 5 (Strongly Agree). Results are for self-reflection only and not a diagnosis. For clinical concerns, consult a qualified professional.</p>
              </div>
              <div>
                <div className="section-title">Progress</div>
                <div className="progress" aria-label="Progress"><div style={{width:progressPct+'%'}}></div></div>
                <div className="hint" style={{marginTop:6}}>{counts.answered} / {counts.total} answered</div>
              </div>
            </div>
          </div>

          {submitted && (
            <div className="card results" style={{marginBottom:16}}>
              {counts.answered !== counts.total && (
                <div className="hint" style={{marginBottom:8, color:'var(--warn)'}}>Note: results computed with incomplete responses. For best accuracy, answer all items.</div>
              )}
              <div className="section-title">Your Results</div>
              <Metric label="Attachment Anxiety" value={scores.anxiety || 0} goodHigh={false} />
              <Metric label="Attachment Avoidance" value={scores.avoidance || 0} goodHigh={false} />
              <Metric label="Interaction Constructiveness" value={scores.interaction || 0} />
              <Metric label="Affect & Repair Balance" value={scores.affect || 0} />
              <Metric label="Cohesion & Flexibility" value={scores.cohesion || 0} />
              <div style={{marginTop:12, paddingTop:8}}>
                <div style={{fontWeight:700}}>Security Index</div>
                <div className="hint">Composite inverse of Anxiety & Avoidance (higher = more secure): <span style={{fontFamily:'ui-monospace, SFMono-Regular, Menlo, Consolas, monospace', border:'1px solid rgba(255,255,255,.2)', padding:'2px 6px', borderRadius:6}}> {scores.securityIndex?.toFixed(2)} / 5</span></div>
              </div>
              <div style={{marginTop:12, padding:12, borderRadius:12, background:'rgba(67,208,138,.1)', border:'1px solid rgba(67,208,138,.3)'}}>
                <div style={{fontWeight:700}}>Pattern Snapshot: {profile.type}</div>
                <div className="hint">{profile.note}</div>
              </div>
            </div>
          )}

          <Section dimKey="anxiety" items={sections.anxiety} answers={answers} setAnswer={setAnswer} />
          <Section dimKey="avoidance" items={sections.avoidance} answers={answers} setAnswer={setAnswer} />
          <Section dimKey="interaction" items={sections.interaction} answers={answers} setAnswer={setAnswer} />
          <Section dimKey="affect" items={sections.affect} answers={answers} setAnswer={setAnswer} />
          <Section dimKey="cohesion" items={sections.cohesion} answers={answers} setAnswer={setAnswer} />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(<App />);
  </script>
</body>
</html>
